name: Trigger FalkorDB Cloud Version Update

on:
  release:
    types: [published]

jobs:
  trigger-omnistrate-update:
    runs-on: ubuntu-latest
    steps:
      - name: Extract release tag
        id: extract_tag
        run: |
          # Extract tag name from the release
          TAG_NAME="${{ github.event.release.tag_name }}"
          echo "tag_name=$TAG_NAME" >> $GITHUB_OUTPUT
          echo "Release tag: $TAG_NAME"

      - name: Trigger workflow in FalkorDB/falkordb-omnistrate
        uses: peter-evans/repository-dispatch@v4
        with:
          token: ${{ secrets.FALKORDB_OMNISTRATE_PAT }}
          repository: FalkorDB/falkordb-omnistrate
          event-type: bump-falkordb-version
          client-payload: |
            {
              "new_version": "${{ steps.extract_tag.outputs.tag_name }}"
            }

      - name: Log successful trigger
        run: |
          echo "Successfully triggered bump-falkordb-version workflow in FalkorDB/falkordb-omnistrate"
          echo "New version: ${{ steps.extract_tag.outputs.tag_name }}"